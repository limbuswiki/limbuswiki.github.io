<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Î¶ºÎ≤ÑÏä§ Ïª¥ÌçºÎãà ÏúÑÌÇ§ HTML ÏÉùÏÑ±Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #f5f5f5;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            display: grid;
            grid-template-columns: auto auto;
            gap: 20px;
            zoom: 0.67;
            animation: fadeIn 0.8s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            max-height: 150vh;
            width: 750px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
        }

        .preview-panel {
            justify-content: center;
        }

        .menu-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
        }

        .menu-btn {
            flex: 1;
            padding: 12px 20px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            color: #333;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .menu-btn:hover {
            background: linear-gradient(to bottom, #f8f8f8, #e8e8e8);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.12);
            transform: translateY(-1px);
        }

        .menu-btn.active {
            background: linear-gradient(to bottom, #000000, #333333);
            color: white;
            border: none;
            box-shadow: 0 3px 6px rgba(0, 0, 0, 0.25);
        }

        .section {
            margin-bottom: 20px;
        }

        .section-title {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px 20px;
            font-size: 15px;
            font-weight: 500;
            color: #333;
            margin-bottom: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s;
        }

        .section-title:hover {
            background: #f8f8f8;
        }

        .section-title .arrow {
            transition: transform 0.3s;
        }

        .section-title.collapsed .arrow {
            transform: rotate(-90deg);
        }

        .section-content {
            max-height: 900px;
            overflow-y: auto;
            transition: max-height 0.3s ease;
        }

        .section-content.collapsed {
            max-height: 0;
        }

        .add-remove-section {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .icon-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: none;
            background: #f0f0f0;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s;
        }

        .icon-btn:hover {
            background: #e0e0e0;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3498db;
        }

        .form-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .content-area {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            background: white;
            max-height: 800px;
            overflow-y: auto;
        }

        .preview-area {
            border: 1px solid #e0e0e0;
            border-radius: 20px;
            padding: 30px;
            min-height: 800px;
            background: #f5f5f5;
            overflow-x: auto;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .menu-content {
            display: none;
        }

        .menu-content.active {
            display: block;
        }

        .download-btn {
            padding: 15px;
            background: linear-gradient(to bottom, #ffffff, #f0f0f0);
            color: #333;
            border: none;
            border-radius: 20px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08);
        }

        .download-btn:hover {
            background: linear-gradient(to bottom, #f8f8f8, #e8e8e8);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.12);
            transform: translateY(-1px);
        }

        .download-btn.black {
            background: linear-gradient(to bottom, #000000, #333333);
            color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.15);
        }

        .download-btn.black:hover {
            background: linear-gradient(to bottom, #1a1a1a, #404040);
            box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        }

        .download-btn.red {
            background: linear-gradient(to bottom, #8b0000, #5a0000);
            color: white;
            box-shadow: 0 2px 4px rgba(139, 0, 0, 0.3);
        }

        .download-btn.red:hover {
            background: linear-gradient(to bottom, #a00000, #6b0000);
            box-shadow: 0 3px 5px rgba(139, 0, 0, 0.4);
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .button-group button {
            flex: 1;
            margin: 0;
        }

        .toc-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 6px;
            transition: all 0.2s;
            cursor: grab;
        }

        .toc-item:active {
            cursor: grabbing;
        }

        .toc-item:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            background: #fafafa;
        }

        .toc-item.sub-item {
            margin-left: 30px;
            background: #f8f8f8;
        }

        .toc-item input {
            flex: 1;
            cursor: text;
        }
        
        .toc-item button {
            cursor: pointer;
        }

        .toc-btn-group {
            display: flex;
            gap: 5px;
        }

        .toc-action-btn {
            background: #000000;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .toc-action-btn:hover {
            background: #333333;
        }

        .toc-remove {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 12px;
        }

        .toc-remove:hover {
            background: #c0392b;
        }

        .preview-toc {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 12px 20px 18px;
            margin-bottom: 20px;
            background: white;
        }

        .preview-toc-title {
            font-size: 1.25em;
            margin-bottom: 10px;
        }

        .preview-toc-item {
            color: #006dd7;
            margin: 5px 0;
        }

        .preview-toc-item.sub {
            padding-left: 22px;
        }

        .preview-info-table {
            width: 325px;
            border: 2px solid #bd0000;
            border-collapse: collapse;
            background: white;
            margin-bottom: 20px;
        }

        .preview-info-table td {
            border: 1px solid #000;
            padding: 8px;
        }

        .preview-header {
            background: #000;
            text-align: center;
            padding: 10px;
        }

        .preview-label {
            background: #000;
            color: #e1bf02;
            font-weight: bold;
            text-align: center;
            width: 30%;
        }

        .preview-value {
            background: white;
            text-align: left;
            padding-left: 12px;
        }

        .color-preview {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }

        .content-editor {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background: white;
            margin-top: 10px;
        }

        .content-editor textarea {
            width: 100%;
            min-height: 200px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: inherit;
            font-size: 14px;
            resize: vertical;
        }

        .content-section-header {
            background: #000000;
            color: white;
            padding: 10px 15px;
            border-radius: 20px;
            font-weight: 500;
            margin-top: 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-section-header:hover {
            background: #333333;
        }

        .preview-content h3 {
            color: #333;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
        }

        .preview-content hr {
            margin: 0 0 15px 0;
            border: none;
            border-top: 2px solid #ddd;
        }

        .preview-content p {
            line-height: 1.6;
            margin: 10px 0;
            color: #333;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #996633;
            margin-top: 2px;
            margin-bottom: 6px;
        }

        .preview-table td {
            border: 1px solid #996633;
            padding: 8px;
            color: #ffcc99;
        }

        .preview-table .header-cell {
            background-image: linear-gradient(120deg, #996633 2%, transparent 2%, transparent 3%, #996633 3%, #996633 4%, transparent 4%, transparent 5%, #996633 5%, #996633 6%, transparent 6%, transparent 94%, #996633 94%, #996633 95%, transparent 95%, transparent 96%, #996633 96%, #996633 97%, transparent 97%, transparent 98%, #996633 98%);
            background-color: #170c0a;
            text-align: center;
            padding: 10px;
        }

        .preview-table .label-cell {
            background-color: #000000;
            text-align: center;
            width: 20%;
        }

        .preview-table .value-cell {
            background-color: #3a2716;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="panel">
            <div class="menu-buttons">
                <button class="menu-btn active" onclick="switchMenu(0)">Î™©Ï∞® Î∞è ÌîÑÎ°úÌïÑ</button>
                <button class="menu-btn" onclick="switchMenu(1)">Ïù∏Í≤©</button>
                <button class="menu-btn" onclick="switchMenu(2)">EGO</button>
                <button class="menu-btn" onclick="switchMenu(3)">Î≥∏Î¨∏ ÏûëÏÑ±</button>
            </div>

            <div class="menu-content active" id="menu-0">
                <div class="section">
                    <div class="section-title collapsed" onclick="toggleSection('toc')">
                        <span>Î™©Ï∞® ÏÑ§Ï†ï</span>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="section-content collapsed" id="toc-content">
                        <div class="add-remove-section">
                            <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">Î™©Ï∞® Ìï≠Î™© Ï∂îÍ∞Ä</div>
                            <button class="download-btn black" onclick="addTocItem()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                        </div>
                        <div class="content-area" id="tocList" style="margin-top: 15px;"></div>
                    </div>
                </div>

                <div class="section" style="margin-top: 20px;">
                    <div class="section-title collapsed" onclick="toggleSection('profile')">
                        <span>ÏúÑÌÇ§ ÌîÑÎ°úÌïÑ ÏÑ§Ï†ï</span>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="section-content collapsed" id="profile-content">
                        <div class="content-area">
                            <div class="form-group">
                                <label class="form-label">Î≤àÌò∏</label>
                                <input type="text" class="form-input" id="number" placeholder="Î≤àÌò∏" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ïù¥Î¶Ñ (ÏòÅÎ¨∏)</label>
                                <input type="text" class="form-input" id="nameEng" placeholder="Ïù¥Î¶Ñ (ÏòÅÎ¨∏)" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ïù¥Î¶Ñ (ÌïúÍ∏Ä)</label>
                                <input type="text" class="form-input" id="nameKor" placeholder="Ïù¥Î¶Ñ (ÌïúÍ∏Ä)" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÎåÄÏÇ¨</label>
                                <input type="text" class="form-input" id="quote" placeholder="ÎåÄÏÇ¨" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Î≥∏Î™Ö</label>
                                <input type="text" class="form-input" id="fullName" placeholder="Î≥∏Î™Ö" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">ÏÑ±Î≥Ñ</label>
                                        <input type="text" class="form-input" id="gender" placeholder="ÏÑ±Î≥Ñ" oninput="updateMenu1Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">Ïã†Ïû•</label>
                                        <input type="text" class="form-input" id="height" placeholder="Ïã†Ïû•" oninput="updateMenu1Preview()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">ÏÜåÏÜç</label>
                                        <input type="text" class="form-input" id="affiliation" placeholder="ÏÜåÏÜç" oninput="updateMenu1Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">ÏßÅÏúÑ</label>
                                        <input type="text" class="form-input" id="position" placeholder="ÏßÅÏúÑ" oninput="updateMenu1Preview()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÏÉÅÏßïÏÉâ Ïù¥Î¶Ñ</label>
                                <input type="text" class="form-input" id="colorName" placeholder="ÏÉÅÏßïÏÉâ Ïù¥Î¶Ñ" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÏÉÅÏßïÏÉâ ÏΩîÎìú</label>
                                <input type="text" class="form-input" id="colorCode" placeholder="ÏÉÅÏßïÏÉâ ÏΩîÎìú" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ïñ∏Ïñ¥Î≥Ñ ÌëúÍ∏∞ (Ìïú Ï§ÑÏî© ÏûÖÎ†•)</label>
                                <textarea class="form-input" id="languages" rows="3" placeholder="Ïñ∏Ïñ¥Î≥Ñ ÌëúÍ∏∞ (Ìïú Ï§ÑÏî© ÏûÖÎ†•)" oninput="updateMenu1Preview()" style="resize: vertical;"></textarea>
                            </div>
                        </div>
                    </div>

                    
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleSection('identity-ego-list')">
                            <span>Ïù∏Í≤© & E.G.O Î™©Î°ù</span>
                            <span class="arrow" id="arrow-identity-ego-list">‚ñº</span>
                        </div>
                        <div class="section-content collapsed" id="identity-ego-list-content">
                            <div class="form-group">
                                <label class="form-label">ÏàòÍ∞êÏûê Ïù¥Î¶Ñ</label>
                                <input type="text" class="form-input" id="listPrisonerName" placeholder="ÏàòÍ∞êÏûê Ïù¥Î¶Ñ" oninput="updateMenu1Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÎåÄÌëú Ïª¨Îü¨ ÏΩîÎìú</label>
                                <input type="text" class="form-input" id="listColorCode" placeholder="ÎåÄÌëú Ïª¨Îü¨ ÏΩîÎìú" oninput="updateMenu1Preview()">
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ffc412;">Ïù∏Í≤© - 3ÏÑ±</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">3ÏÑ± Ïù∏Í≤© Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addIdentityStar3()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="identityStar3List" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #e4a600;">Ïù∏Í≤© - 2ÏÑ±</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">2ÏÑ± Ïù∏Í≤© Ïù¥ÎØ∏ÏßÄ Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addIdentityStar2()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="identityStar2List" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ad7640;">E.G.O - ZAYIN</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">ZAYIN E.G.O Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addEgoZAYIN()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="egoZAYINList" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ad7640;">E.G.O - TETH</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">TETH E.G.O Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addEgoTETH()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="egoTETHList" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ad7640;">E.G.O - HE</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">HE E.G.O Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addEgoHE()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="egoHEList" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ad7640;">E.G.O - WAW</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">WAW E.G.O Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addEgoWAW()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="egoWAWList" style="margin-top: 10px;"></div>
                            </div>

                            
                            <div class="form-group" style="margin-top: 20px;">
                                <label class="form-label" style="font-weight: bold; color: #ad7640;">E.G.O - ALEPH</label>
                                <div class="add-remove-section">
                                    <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">ALEPH E.G.O Ï∂îÍ∞Ä</div>
                                    <button class="download-btn black" onclick="addEgoALEPH()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                                </div>
                                <div class="content-area" id="egoALEPHList" style="margin-top: 10px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="menu-content" id="menu-1">
                <div class="content-area">
                    
                    <div class="section">
                        <div class="section-title" onclick="toggleIdentitySection('basic')">
                            <span>ÏÉÅÎã® Ï†ïÎ≥¥</span>
                            <span class="arrow" id="arrow-identity-basic">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-basic">
                            <div class="form-group">
                                <label class="form-label">Ïù∏Í≤© Ïù¥Î¶Ñ (ÏÉÅÎã® ÌëúÏãú)</label>
                                <input type="text" class="form-input" id="identityName" placeholder="Ïù∏Í≤© Ïù¥Î¶Ñ (ÏÉÅÎã® ÌëúÏãú)" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ URL</label>
                                <input type="text" class="form-input" id="identityLogoUrl" placeholder="Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ URL" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÎåÄÌëú Ïª¨Îü¨ ÏΩîÎìú</label>
                                <input type="text" class="form-input" id="representColor" placeholder="ÎåÄÌëú Ïª¨Îü¨ ÏΩîÎìú" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÌöçÎìù ÎåÄÏÇ¨</label>
                                <input type="text" class="form-input" id="acquireDialogue" placeholder="ÌöçÎìù ÎåÄÏÇ¨" oninput="updateMenu2Preview()">
                            </div>
                        </div>
                    </div>

                    
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleIdentitySection('status')">
                            <span>Ïä§ÌÖåÏù¥ÌÑ∞Ïä§ & ÎÇ¥ÏÑ±</span>
                            <span class="arrow" id="arrow-identity-status">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-status">
                            <div class="form-group">
                                <label class="form-label">Ïä§ÌÖåÏù¥ÌÑ∞Ïä§</label>
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">Ï≤¥Î†•</label>
                                        <input type="text" class="form-input" id="hp" placeholder="Ï≤¥Î†•" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">ÏÜçÎèÑ</label>
                                        <input type="text" class="form-input" id="speed" placeholder="ÏÜçÎèÑ" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">Î∞©Ïñ¥Î†•</label>
                                        <input type="text" class="form-input" id="defense" placeholder="Î∞©Ïñ¥Î†•" oninput="updateMenu2Preview()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÎÇ¥ÏÑ± Ï†ïÎ≥¥</label>
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">Ï∞∏Í≤©</label>
                                        <input type="text" class="form-input" id="slashRes" placeholder="Ï∞∏Í≤©" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">Í¥ÄÌÜµ</label>
                                        <input type="text" class="form-input" id="pierceRes" placeholder="Í¥ÄÌÜµ" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">ÌÉÄÍ≤©</label>
                                        <input type="text" class="form-input" id="bluntRes" placeholder="ÌÉÄÍ≤©" oninput="updateMenu2Preview()">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleIdentitySection('table')">
                            <span>Í∏∞Î≥∏ Ï†ïÎ≥¥</span>
                            <span class="arrow" id="arrow-identity-table">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-table">
                            <div class="form-group">
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">ÏàòÍ∞êÏûê Ïù¥Î¶Ñ</label>
                                        <input type="text" class="form-input" id="prisonerName" placeholder="ÏàòÍ∞êÏûê Ïù¥Î¶Ñ" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">ÏãúÏ¶å</label>
                                        <input type="text" class="form-input" id="season" placeholder="ÏãúÏ¶å" oninput="updateMenu2Preview()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="form-input-group">
                                    <div>
                                        <label class="form-label">Ïù∏Í≤© Îì±Í∏â</label>
                                        <input type="text" class="form-input" id="grade" placeholder="Ïù∏Í≤© Îì±Í∏â" oninput="updateMenu2Preview()">
                                    </div>
                                    <div>
                                        <label class="form-label">Ï∂úÏãú ÏãúÍ∏∞</label>
                                        <input type="text" class="form-input" id="releaseDate" placeholder="Ï∂úÏãú ÏãúÍ∏∞" oninput="updateMenu2Preview()">
                                    </div>
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ìã∞Ïºì Ïù∏ÏÇ¨Îßê</label>
                                <input type="text" class="form-input" id="greeting" placeholder="Ìã∞Ïºì Ïù∏ÏÇ¨Îßê" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÌöçÎìù Î∞©Î≤ï</label>
                                <input type="text" class="form-input" id="obtainMethod" placeholder="ÌöçÎìù Î∞©Î≤ï" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ÌäπÏÑ± ÌÇ§ÏõåÎìú</label>
                                <input type="text" class="form-input" id="keywords" placeholder="ÌäπÏÑ± ÌÇ§ÏõåÎìú" oninput="updateMenu2Preview()">
                            </div>
                        </div>
                    </div>

                    <!--Ïª§ÎØ∏ÏÖò Ï∂úÏ≤òÎäî ÏóÜÏùÑ Ïãú ÏΩîÎìú Ï†úÏô∏-->
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleIdentitySection('images')">
                            <span>Ïù¥ÎØ∏ÏßÄ</span>
                            <span class="arrow" id="arrow-identity-images">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-images">
                            <div class="form-group">
                                <label class="form-label">ÏùºÎü¨Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ URL</label>
                                <input type="text" class="form-input" id="identityIllust" placeholder="ÏùºÎü¨Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ URL" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ïª§ÎØ∏ÏÖò Ï∂úÏ≤ò</label>
                                <input type="text" class="form-input" id="commissionSource" placeholder="Ïª§ÎØ∏ÏÖò Ï∂úÏ≤ò" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">SD Ïù¥ÎØ∏ÏßÄ URL</label>
                                <input type="text" class="form-input" id="sdImageUrl" placeholder="SD Ïù¥ÎØ∏ÏßÄ URL" oninput="updateMenu2Preview()">
                            </div>
                        </div>
                    </div>

                    
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleIdentitySection('story')">
                            <span>Ïä§ÌÜ†Î¶¨</span>
                            <span class="arrow" id="arrow-identity-story">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-story">
                            <div class="form-group">
                                <label class="form-label">Ïä§ÌÜ†Î¶¨ Ï†úÎ™©</label>
                                <input type="text" class="form-input" id="storyTitle" placeholder="Ïä§ÌÜ†Î¶¨ Ï†úÎ™©" oninput="updateMenu2Preview()">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Ïä§ÌÜ†Î¶¨ Î≥∏Î¨∏</label>
                                <textarea class="form-input" id="storyContent" placeholder="Ïä§ÌÜ†Î¶¨ Î≥∏Î¨∏" style="min-height: 200px; resize: vertical; font-family: inherit;" oninput="updateMenu2Preview()"></textarea>
                            </div>
                        </div>
                    </div>

                    
                    <div class="section" style="margin-top: 20px;">
                        <div class="section-title" onclick="toggleIdentitySection('dialogues')">
                            <span>ÎåÄÏÇ¨</span>
                            <span class="arrow" id="arrow-identity-dialogues">‚ñº</span>
                        </div>
                        <div class="section-content" id="identity-section-dialogues">
                            <div class="add-remove-section">
                                <div style="flex: 1; padding: 10px; background: white; border: 1px solid #ddd; border-radius: 6px;">ÎåÄÏÇ¨ Ìï≠Î™© Ï∂îÍ∞Ä</div>
                                <button class="download-btn black" onclick="addDialogueItem()" style="padding: 8px 20px; border-radius: 15px;">Ï∂îÍ∞Ä</button>
                            </div>
                            <div class="content-area" id="dialogueList" style="margin-top: 15px;"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="menu-content" id="menu-2">
                <div class="content-area">
                    <div class="form-group">
                        <label class="form-label">Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ URL</label>
                        <input type="text" class="form-input" id="logoUrl" placeholder="Î°úÍ≥† Ïù¥ÎØ∏ÏßÄ URL" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ïù∏Í≤© Î™ÖÏπ≠</label>
                        <input type="text" class="form-input" id="egoTitle" placeholder="Ïù∏Í≤© Î™ÖÏπ≠" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÎåÄÏÇ¨</label>
                        <input type="text" class="form-input" id="egoQuote" placeholder="ÎåÄÏÇ¨" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÏùºÎü¨Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ URL</label>
                        <input type="text" class="form-input" id="illustUrl" placeholder="ÏùºÎü¨Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ URL" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <div class="form-input-group">
                            <div>
                                <label class="form-label">ÌôòÏÉÅÏ≤¥</label>
                                <input type="text" class="form-input" id="abnormality" placeholder="ÌôòÏÉÅÏ≤¥" oninput="updateMenu3Preview()">
                            </div>
                            <div>
                                <label class="form-label">ÏãúÏ¶å</label>
                                <input type="text" class="form-input" id="egoSeason" placeholder="ÏãúÏ¶å" oninput="updateMenu3Preview()">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-input-group">
                            <div>
                                <label class="form-label">E.G.O Î™ÖÏπ≠</label>
                                <input type="text" class="form-input" id="egoName" placeholder="E.G.O Î™ÖÏπ≠" oninput="updateMenu3Preview()">
                            </div>
                            <div>
                                <label class="form-label">E.G.O Îì±Í∏â</label>
                                <select class="form-input" id="egoGrade" onchange="updateMenu3Preview()">
                                    <option value="">E.G.O Îì±Í∏â</option>
                                    <option value="ZAYIN">ZAYIN</option>
                                    <option value="TETH">TETH</option>
                                    <option value="HE">HE</option>
                                    <option value="WAW">WAW</option>
                                    <option value="ALEPH">ALEPH</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="form-input-group">
                            <div>
                                <label class="form-label">ÏàòÍ∞êÏûê</label>
                                <input type="text" class="form-input" id="egoPrisoner" placeholder="ÏàòÍ∞êÏûê" oninput="updateMenu3Preview()">
                            </div>
                            <div>
                                <label class="form-label">Ï∂úÏãú ÏãúÍ∏∞</label>
                                <input type="text" class="form-input" id="egoReleaseDate" placeholder="Ï∂úÏãú ÏãúÍ∏∞" oninput="updateMenu3Preview()">
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Ìã∞Ïºì Ïù∏ÏÇ¨Îßê</label>
                        <input type="text" class="form-input" id="egoGreeting" placeholder="Ìã∞Ïºì Ïù∏ÏÇ¨Îßê" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÌöçÎìù Î∞©Î≤ï</label>
                        <input type="text" class="form-input" id="egoObtain" placeholder="ÌöçÎìù Î∞©Î≤ï" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">ÌäπÏÑ± ÌÇ§ÏõåÎìú</label>
                        <input type="text" class="form-input" id="egoKeywords" placeholder="ÌäπÏÑ± ÌÇ§ÏõåÎìú" oninput="updateMenu3Preview()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Î∞∞Í≤ΩÏÉâ ÏΩîÎìú</label>
                        <input type="text" class="form-input" id="egoBgColor" placeholder="Î∞∞Í≤ΩÏÉâ ÏΩîÎìú" oninput="updateMenu3Preview()">
                    </div>
                </div>
            </div>

            <div class="menu-content" id="menu-3">
                <div id="contentSections"></div>
            </div>

            <div class="button-group">
                <button class="download-btn black" onclick="document.getElementById('jsonUpload').click()">JSON Î∂àÎü¨Ïò§Í∏∞</button>
                <button class="download-btn black" onclick="saveJSON()">JSON Ï†ÄÏû•</button>
                <input type="file" id="jsonUpload" accept=".json" style="display: none;" onchange="loadJSON(event)">
            </div>
            
            <div style="margin-top: 10px;">
                <button class="download-btn red" style="width: 100%;" onclick="downloadHTML()">HTML Îã§Ïö¥Î°úÎìú</button>
            </div>
        </div>

        <div class="panel preview-panel">
            <div class="preview-area" id="preview"></div>
        </div>
    </div>

    <script>
        let currentState = {
            activeMenu: 0,
            sectionsVisible: {
                toc: false,
                profile: false,
                'identity-ego-list': false
            },
            tocItems: [
                { level: 1, text: '1. Í∞úÏöî' },
                { level: 1, text: '2. ÏÉÅÏÑ∏' },
                { level: 1, text: '3. ÏûëÏ§ë ÌñâÏ†Å' }
            ],
            wikiProfile: {
                number: 'No. 00',
                nameEng: 'MARCH',
                nameKor: 'ÎßàÏπò',
                quote: 'Ï¥àÎåÄÌïòÏßÄÎèÑ ÏïäÏïòÎäîÎç∞ Îì¨Îøç ÏïâÏïÑ Î≤ÑÎ¶¨Îäî Í≤å Îçî Ïã§Î°ÄÏïº.',
                fullName: 'ÎßàÏπò Ìó§Ïù¥Ïñ¥',
                gender: 'Ïó¨ÏÑ±',
                height: '166cm',
                affiliation: 'Î¶ºÎ≤ÑÏä§ Ïª¥ÌçºÎãà',
                position: 'Í¥ÄÎ¶¨Ïûê',
                colorName: 'MADNESS RED',
                colorCode: '#8b2d2c',
                languages: 'üá∞üá∑ ÎßàÏπò\nüá∫üá∏ March\nüáØüáµ „Éû„Éº„ÉÅ'
            },
            identityEgoList: {
                prisonerName: '',
                colorCode: '',
                identities: {
                    star3: [],
                    star2: []
                },
                egos: {
                    ZAYIN: [],
                    TETH: [],
                    HE: [],
                    WAW: [],
                    ALEPH: []
                }
            },
            identityInfo: {
                identityName: '',
                identityLogoUrl: '',
                representColor: '',
                acquireDialogue: '',
                illustUrl: '',
                commissionSource: '',
                hp: '',
                speed: '',
                defense: '',
                slashRes: '',
                pierceRes: '',
                bluntRes: '',
                prisonerName: '',
                season: '',
                grade: '',
                releaseDate: '',
                greeting: '',
                obtainMethod: '',
                keywords: '',
                sdImageUrl: '',
                storyTitle: '',
                storyContent: '',
                dialogues: []
            },
            egoInfo: {
                logoUrl: '',
                title: '',
                quote: '',
                illustUrl: '',
                abnormality: '',
                season: '',
                egoName: '',
                egoGrade: '',
                prisoner: '',
                releaseDate: '',
                greeting: '',
                obtainMethod: '',
                keywords: '',
                bgColor: '#73468a'
            },
            contentSections: {}
        };

        function switchMenu(index) {
            document.querySelectorAll('.menu-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.menu-content').forEach(content => content.classList.remove('active'));
            document.querySelectorAll('.menu-btn')[index].classList.add('active');
            document.getElementById(`menu-${index}`).classList.add('active');
            currentState.activeMenu = index;
            
            if (index === 0) {
                renderTocList();
                loadWikiProfile();
                updateMenu1Preview();
            } else if (index === 1) {
                loadIdentityInfo();
                updateMenu2Preview();
            } else if (index === 2) {
                loadEgoInfo();
                updateMenu3Preview();
            } else if (index === 3) {
                renderContentSections();
                updateMenu4Preview();
            }
        }

        function toggleSection(sectionId) {
            const content = document.getElementById(`${sectionId}-content`);
            const title = content.previousElementSibling;
            content.classList.toggle('collapsed');
            title.classList.toggle('collapsed');
            
            const isVisible = !content.classList.contains('collapsed');
            currentState.sectionsVisible[sectionId] = isVisible;
            
            updateMenu1Preview();
        }

        function toggleIdentitySection(sectionName) {
            const content = document.getElementById(`identity-section-${sectionName}`);
            const arrow = document.getElementById(`arrow-identity-${sectionName}`);
            const title = content.previousElementSibling;
            
            content.classList.toggle('collapsed');
            title.classList.toggle('collapsed');
        }

        function renderTocList() {
            const tocList = document.getElementById('tocList');
            tocList.innerHTML = '';
            
            currentState.tocItems.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = item.level === 2 ? 'toc-item sub-item' : 'toc-item';
                div.draggable = true;
                div.dataset.index = index;
                
                div.addEventListener('dragstart', handleDragStart);
                div.addEventListener('dragover', handleDragOver);
                div.addEventListener('dragenter', handleDragEnter);
                div.addEventListener('dragleave', handleDragLeave);
                div.addEventListener('drop', handleDrop);
                div.addEventListener('dragend', handleDragEnd);
                
                const titleWithoutNumber = item.text.replace(/^[\d.]+\.?\s*/, '');
                
                div.innerHTML = `
                    <span class="drag-handle" style="cursor: grab; padding: 0 10px; font-size: 18px; color: #999; user-select: none;">‚ãÆ‚ãÆ</span>
                    <input type="text" class="form-input toc-input" value="${titleWithoutNumber}" 
                           onchange="updateTocItemText(${index}, this.value)">
                    <div class="toc-btn-group">
                        ${item.level === 1 ? `<button class="toc-action-btn" onclick="addSubItem(${index})">ÌïòÏúÑ</button>` : ''}
                        <button class="toc-remove" onclick="removeTocItemAt(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                const input = div.querySelector('.toc-input');
                const buttons = div.querySelectorAll('button');
                
                input.addEventListener('mousedown', (e) => e.stopPropagation());
                input.addEventListener('click', (e) => e.stopPropagation());
                buttons.forEach(btn => {
                    btn.addEventListener('mousedown', (e) => e.stopPropagation());
                    btn.addEventListener('click', (e) => e.stopPropagation());
                });
                tocList.appendChild(div);
            });
            
            renumberTocItems();
        }

        let draggedIndex = null;
        let dropIndicator = null;

        function handleDragStart(e) {
            draggedIndex = parseInt(e.currentTarget.dataset.index);
            e.currentTarget.style.opacity = '0.4';
            e.dataTransfer.effectAllowed = 'move';
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.dataTransfer.dropEffect = 'move';
            
            const targetElement = e.currentTarget;
            const rect = targetElement.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            
            document.querySelectorAll('.toc-item').forEach(item => {
                item.style.borderTop = '';
                item.style.borderBottom = '';
            });
            
            if (e.clientY < midpoint) {
                targetElement.style.borderTop = '3px solid #3498db';
            } else {
                targetElement.style.borderBottom = '3px solid #3498db';
            }
        }

        function handleDragEnter(e) {
            e.preventDefault();
        }

        function handleDragLeave(e) {
            if (!e.currentTarget.contains(e.relatedTarget)) {
                e.currentTarget.style.borderTop = '';
                e.currentTarget.style.borderBottom = '';
            }
        }

        function handleDrop(e) {
            e.preventDefault();
            
            const targetElement = e.currentTarget;
            const rect = targetElement.getBoundingClientRect();
            const midpoint = rect.top + rect.height / 2;
            const dropIndex = parseInt(targetElement.dataset.index);

            document.querySelectorAll('.toc-item').forEach(item => {
                item.style.borderTop = '';
                item.style.borderBottom = '';
            });
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                const draggedItem = currentState.tocItems[draggedIndex];
                const targetItem = currentState.tocItems[dropIndex];
                
                if (draggedItem.level === 2) {
                    if (targetItem.level === 1) {
                        alert('ÌïòÏúÑ Ìï≠Î™©ÏùÄ ÏÉÅÏúÑ Ìï≠Î™© ÏúÑÎ°ú Ïù¥ÎèôÌï† Ïàò ÏóÜÏäµÎãàÎã§.');
                        return;
                    }
                    
                    let draggedParentIndex = -1;
                    for (let i = draggedIndex - 1; i >= 0; i--) {
                        if (currentState.tocItems[i].level === 1) {
                            draggedParentIndex = i;
                            break;
                        }
                    }
                                        let targetParentIndex = -1;
                    for (let i = dropIndex - 1; i >= 0; i--) {
                        if (currentState.tocItems[i].level === 1) {
                            targetParentIndex = i;
                            break;
                        }
                    }
                    
                    if (draggedParentIndex === -1 || targetParentIndex === -1) {
                        return;
                    }
                }
                
                const draggedContent = currentState.contentSections[draggedIndex] || '';
                
                const contentArray = [];
                for (let i = 0; i < currentState.tocItems.length; i++) {
                    contentArray[i] = currentState.contentSections[i] || '';
                }
                

                const dropAbove = e.clientY < midpoint;
                
                currentState.tocItems.splice(draggedIndex, 1);
                contentArray.splice(draggedIndex, 1);
                
                let newIndex;
                if (dropAbove) {

                    newIndex = draggedIndex < dropIndex ? dropIndex - 1 : dropIndex;
                } else {

                    newIndex = draggedIndex < dropIndex ? dropIndex : dropIndex + 1;
                }
                
                currentState.tocItems.splice(newIndex, 0, draggedItem);
                contentArray.splice(newIndex, 0, draggedContent);
                
                currentState.contentSections = {};
                for (let i = 0; i < contentArray.length; i++) {
                    if (contentArray[i]) {
                        currentState.contentSections[i] = contentArray[i];
                    }
                }
                
                renderTocList();
                updateMenu1Preview();
            }
        }

        function handleDragEnd(e) {
            e.currentTarget.style.opacity = '1';
            document.querySelectorAll('.toc-item').forEach(item => {
                item.style.borderTop = '';
                item.style.borderBottom = '';
            });
            draggedIndex = null;
        }

        function renumberTocItems() {
            let mainCounter = 1;
            let subCounters = {};
            
            currentState.tocItems.forEach((item, index) => {
                if (item.level === 1) {
                    const titleWithoutNumber = item.text.replace(/^[\d.]+\.?\s*/, '');
                    item.text = `${mainCounter}. ${titleWithoutNumber}`;
                    subCounters[mainCounter] = 1;
                    mainCounter++;
                } else if (item.level === 2) {
                    let parentNumber = 1;
                    for (let i = index - 1; i >= 0; i--) {
                        if (currentState.tocItems[i].level === 1) {
                            const match = currentState.tocItems[i].text.match(/^(\d+)\./);
                            if (match) {
                                parentNumber = parseInt(match[1]);
                                break;
                            }
                        }
                    }
                    
                    const titleWithoutNumber = item.text.replace(/^[\d.]+\.?\s*/, '');
                    item.text = `${parentNumber}.${subCounters[parentNumber]}. ${titleWithoutNumber}`;
                    subCounters[parentNumber]++;
                }
            });
            
            updateMenu1Preview();
        }

        function updateTocItemText(index, newText) {
            const item = currentState.tocItems[index];
            const currentNumber = item.text.match(/^[\d.]+\.?\s*/)?.[0] || '';
            item.text = currentNumber + newText;
            updateMenu1Preview();
        }

        function addTocItem() {
            const newIndex = currentState.tocItems.length;
            currentState.tocItems.push({ level: 1, text: 'ÏÉà Ìï≠Î™©' });
            renderTocList();
        }

        function addSubItem(parentIndex) {
            const newSubItem = { level: 2, text: 'ÏÉà ÌïòÏúÑ Ìï≠Î™©' };
            
            let insertIndex = parentIndex + 1;
            for (let i = parentIndex + 1; i < currentState.tocItems.length; i++) {
                if (currentState.tocItems[i].level === 1) break;
                insertIndex = i + 1;
            }
            
            const contentArray = [];
            for (let i = 0; i < currentState.tocItems.length; i++) {
                contentArray[i] = currentState.contentSections[i] || '';
            }
            
            currentState.tocItems.splice(insertIndex, 0, newSubItem);
            contentArray.splice(insertIndex, 0, '');
            
            currentState.contentSections = {};
            for (let i = 0; i < contentArray.length; i++) {
                if (contentArray[i]) {
                    currentState.contentSections[i] = contentArray[i];
                }
            }
            
            renderTocList();
        }

        function removeTocItem() {
            if (currentState.tocItems.length > 0) {
                const lastIndex = currentState.tocItems.length - 1;
                currentState.tocItems.pop();
                
                if (currentState.contentSections[lastIndex]) {
                    delete currentState.contentSections[lastIndex];
                }
                
                renderTocList();
            }
        }

        function removeTocItemAt(index) {
            const contentArray = [];
            for (let i = 0; i < currentState.tocItems.length; i++) {
                contentArray[i] = currentState.contentSections[i] || '';
            }

            currentState.tocItems.splice(index, 1);
            contentArray.splice(index, 1);

            currentState.contentSections = {};
            for (let i = 0; i < contentArray.length; i++) {
                if (contentArray[i]) {
                    currentState.contentSections[i] = contentArray[i];
                }
            }
            
            renderTocList();
        }

        function addDialogueItem() {
            currentState.identityInfo.dialogues.push({
                label: '',
                content: ''
            });
            renderDialogueList();
        }

        function removeDialogueItem(index) {
            currentState.identityInfo.dialogues.splice(index, 1);
            renderDialogueList();
            updateMenu2Preview();
        }

        function updateDialogueLabel(index, value) {
            currentState.identityInfo.dialogues[index].label = value;
            updateMenu2Preview();
        }

        function updateDialogueContent(index, value) {
            currentState.identityInfo.dialogues[index].content = value;
            updateMenu2Preview();
        }

        function renderDialogueList() {
            const dialogueList = document.getElementById('dialogueList');
            dialogueList.innerHTML = '';
            
            currentState.identityInfo.dialogues.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 15px; background: #f8f8f8; border-radius: 8px; margin-bottom: 10px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 200px 1fr auto; gap: 10px; align-items: start;">
                        <div>
                            <label class="form-label">ÎåÄÏÇ¨ Î†àÏù¥Î∏î</label>
                            <input type="text" class="form-input" value="${item.label}" 
                                   placeholder="ÎåÄÏÇ¨ Î†àÏù¥Î∏î"
                                   onchange="updateDialogueLabel(${index}, this.value)">
                        </div>
                        <div>
                            <label class="form-label">ÎåÄÏÇ¨ ÎÇ¥Ïö©</label>
                            <input type="text" class="form-input" value="${item.content}" 
                                   placeholder="ÎåÄÏÇ¨ ÎÇ¥Ïö©"
                                   onchange="updateDialogueContent(${index}, this.value)">
                        </div>
                        <button class="toc-remove" onclick="removeDialogueItem(${index})" style="margin-top: 28px;">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                dialogueList.appendChild(div);
            });
        }

        function addIdentityStar3() {
            currentState.identityEgoList.identities.star3.push({ imageUrl: '' });
            renderIdentityStar3List();
        }

        function removeIdentityStar3(index) {
            currentState.identityEgoList.identities.star3.splice(index, 1);
            renderIdentityStar3List();
            updateMenu1Preview();
        }

        function updateIdentityStar3(index, value) {
            currentState.identityEgoList.identities.star3[index].imageUrl = value;
            updateMenu1Preview();
        }

        function renderIdentityStar3List() {
            const list = document.getElementById('identityStar3List');
            list.innerHTML = '';
            
            currentState.identityEgoList.identities.star3.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #fff7e6; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateIdentityStar3(${index}, this.value)">
                        <button class="toc-remove" onclick="removeIdentityStar3(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addIdentityStar2() {
            currentState.identityEgoList.identities.star2.push({ imageUrl: '' });
            renderIdentityStar2List();
        }

        function removeIdentityStar2(index) {
            currentState.identityEgoList.identities.star2.splice(index, 1);
            renderIdentityStar2List();
            updateMenu1Preview();
        }

        function updateIdentityStar2(index, value) {
            currentState.identityEgoList.identities.star2[index].imageUrl = value;
            updateMenu1Preview();
        }

        function renderIdentityStar2List() {
            const list = document.getElementById('identityStar2List');
            list.innerHTML = '';
            
            currentState.identityEgoList.identities.star2.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #fff4e6; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateIdentityStar2(${index}, this.value)">
                        <button class="toc-remove" onclick="removeIdentityStar2(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addEgoZAYIN() {
            currentState.identityEgoList.egos.ZAYIN.push({ imageUrl: '', name: '' });
            renderEgoZAYINList();
        }

        function removeEgoZAYIN(index) {
            currentState.identityEgoList.egos.ZAYIN.splice(index, 1);
            renderEgoZAYINList();
            updateMenu1Preview();
        }

        function updateEgoZAYINImage(index, value) {
            currentState.identityEgoList.egos.ZAYIN[index].imageUrl = value;
            updateMenu1Preview();
        }

        function updateEgoZAYINName(index, value) {
            currentState.identityEgoList.egos.ZAYIN[index].name = value;
            updateMenu1Preview();
        }

        function renderEgoZAYINList() {
            const list = document.getElementById('egoZAYINList');
            list.innerHTML = '';
            
            currentState.identityEgoList.egos.ZAYIN.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #f5f0e8; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 200px auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateEgoZAYINImage(${index}, this.value)">
                        <input type="text" class="form-input" value="${item.name}" 
                               placeholder="E.G.O Ïù¥Î¶Ñ"
                               onchange="updateEgoZAYINName(${index}, this.value)">
                        <button class="toc-remove" onclick="removeEgoZAYIN(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addEgoTETH() {
            currentState.identityEgoList.egos.TETH.push({ imageUrl: '', name: '' });
            renderEgoTETHList();
        }

        function removeEgoTETH(index) {
            currentState.identityEgoList.egos.TETH.splice(index, 1);
            renderEgoTETHList();
            updateMenu1Preview();
        }

        function updateEgoTETHImage(index, value) {
            currentState.identityEgoList.egos.TETH[index].imageUrl = value;
            updateMenu1Preview();
        }

        function updateEgoTETHName(index, value) {
            currentState.identityEgoList.egos.TETH[index].name = value;
            updateMenu1Preview();
        }

        function renderEgoTETHList() {
            const list = document.getElementById('egoTETHList');
            list.innerHTML = '';
            
            currentState.identityEgoList.egos.TETH.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #f5f0e8; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 200px auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateEgoTETHImage(${index}, this.value)">
                        <input type="text" class="form-input" value="${item.name}" 
                               placeholder="E.G.O Ïù¥Î¶Ñ"
                               onchange="updateEgoTETHName(${index}, this.value)">
                        <button class="toc-remove" onclick="removeEgoTETH(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addEgoHE() {
            currentState.identityEgoList.egos.HE.push({ imageUrl: '', name: '' });
            renderEgoHEList();
        }

        function removeEgoHE(index) {
            currentState.identityEgoList.egos.HE.splice(index, 1);
            renderEgoHEList();
            updateMenu1Preview();
        }

        function updateEgoHEImage(index, value) {
            currentState.identityEgoList.egos.HE[index].imageUrl = value;
            updateMenu1Preview();
        }

        function updateEgoHEName(index, value) {
            currentState.identityEgoList.egos.HE[index].name = value;
            updateMenu1Preview();
        }

        function renderEgoHEList() {
            const list = document.getElementById('egoHEList');
            list.innerHTML = '';
            
            currentState.identityEgoList.egos.HE.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #f5f0e8; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 200px auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateEgoHEImage(${index}, this.value)">
                        <input type="text" class="form-input" value="${item.name}" 
                               placeholder="E.G.O Ïù¥Î¶Ñ"
                               onchange="updateEgoHEName(${index}, this.value)">
                        <button class="toc-remove" onclick="removeEgoHE(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addEgoWAW() {
            currentState.identityEgoList.egos.WAW.push({ imageUrl: '', name: '' });
            renderEgoWAWList();
        }

        function removeEgoWAW(index) {
            currentState.identityEgoList.egos.WAW.splice(index, 1);
            renderEgoWAWList();
            updateMenu1Preview();
        }

        function updateEgoWAWImage(index, value) {
            currentState.identityEgoList.egos.WAW[index].imageUrl = value;
            updateMenu1Preview();
        }

        function updateEgoWAWName(index, value) {
            currentState.identityEgoList.egos.WAW[index].name = value;
            updateMenu1Preview();
        }

        function renderEgoWAWList() {
            const list = document.getElementById('egoWAWList');
            list.innerHTML = '';
            
            currentState.identityEgoList.egos.WAW.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #f5f0e8; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 200px auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateEgoWAWImage(${index}, this.value)">
                        <input type="text" class="form-input" value="${item.name}" 
                               placeholder="E.G.O Ïù¥Î¶Ñ"
                               onchange="updateEgoWAWName(${index}, this.value)">
                        <button class="toc-remove" onclick="removeEgoWAW(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function addEgoALEPH() {
            currentState.identityEgoList.egos.ALEPH.push({ imageUrl: '', name: '' });
            renderEgoALEPHList();
        }

        function removeEgoALEPH(index) {
            currentState.identityEgoList.egos.ALEPH.splice(index, 1);
            renderEgoALEPHList();
            updateMenu1Preview();
        }

        function updateEgoALEPHImage(index, value) {
            currentState.identityEgoList.egos.ALEPH[index].imageUrl = value;
            updateMenu1Preview();
        }

        function updateEgoALEPHName(index, value) {
            currentState.identityEgoList.egos.ALEPH[index].name = value;
            updateMenu1Preview();
        }

        function renderEgoALEPHList() {
            const list = document.getElementById('egoALEPHList');
            list.innerHTML = '';
            
            currentState.identityEgoList.egos.ALEPH.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'form-group';
                div.style.cssText = 'padding: 10px; background: #f5f0e8; border-radius: 6px; margin-bottom: 8px;';
                
                div.innerHTML = `
                    <div style="display: grid; grid-template-columns: 1fr 200px auto; gap: 10px; align-items: center;">
                        <input type="text" class="form-input" value="${item.imageUrl}" 
                               placeholder="Ïù¥ÎØ∏ÏßÄ URL"
                               onchange="updateEgoALEPHImage(${index}, this.value)">
                        <input type="text" class="form-input" value="${item.name}" 
                               placeholder="E.G.O Ïù¥Î¶Ñ"
                               onchange="updateEgoALEPHName(${index}, this.value)">
                        <button class="toc-remove" onclick="removeEgoALEPH(${index})">ÏÇ≠Ï†ú</button>
                    </div>
                `;
                
                list.appendChild(div);
            });
        }

        function loadWikiProfile() {
            document.getElementById('number').value = currentState.wikiProfile.number;
            document.getElementById('nameEng').value = currentState.wikiProfile.nameEng;
            document.getElementById('nameKor').value = currentState.wikiProfile.nameKor;
            document.getElementById('quote').value = currentState.wikiProfile.quote;
            document.getElementById('fullName').value = currentState.wikiProfile.fullName;
            document.getElementById('gender').value = currentState.wikiProfile.gender;
            document.getElementById('height').value = currentState.wikiProfile.height;
            document.getElementById('affiliation').value = currentState.wikiProfile.affiliation;
            document.getElementById('position').value = currentState.wikiProfile.position;
            document.getElementById('colorName').value = currentState.wikiProfile.colorName;
            document.getElementById('colorCode').value = currentState.wikiProfile.colorCode;
            document.getElementById('languages').value = currentState.wikiProfile.languages;
            
            document.getElementById('listPrisonerName').value = currentState.identityEgoList.prisonerName || '';
            document.getElementById('listColorCode').value = currentState.identityEgoList.colorCode || '';
            renderIdentityStar3List();
            renderIdentityStar2List();
            renderEgoZAYINList();
            renderEgoTETHList();
            renderEgoHEList();
            renderEgoWAWList();
            renderEgoALEPHList();
        }

        function updateMenu1Preview() {
            const info = {
                number: document.getElementById('number').value || 'No. 00',
                nameEng: document.getElementById('nameEng').value || 'NAME',
                nameKor: document.getElementById('nameKor').value || 'Ïù¥Î¶Ñ',
                quote: document.getElementById('quote').value || 'ÎåÄÏÇ¨Î•º ÏûÖÎ†•ÌïòÏÑ∏Ïöî',
                fullName: document.getElementById('fullName').value || 'Ï†ÑÏ≤¥ Ïù¥Î¶Ñ',
                gender: document.getElementById('gender').value || 'ÏÑ±Î≥Ñ',
                height: document.getElementById('height').value || 'Ïã†Ïû•',
                affiliation: document.getElementById('affiliation').value || 'ÏÜåÏÜç',
                position: document.getElementById('position').value || 'ÏßÅÏúÑ',
                colorName: document.getElementById('colorName').value || 'COLOR',
                colorCode: document.getElementById('colorCode').value || '#000000',
                languages: document.getElementById('languages').value || 'Ïñ∏Ïñ¥Î≥Ñ ÌëúÍ∏∞'
            };

            currentState.wikiProfile = info;
            
            currentState.identityEgoList.prisonerName = document.getElementById('listPrisonerName').value || '';
            currentState.identityEgoList.colorCode = document.getElementById('listColorCode').value || '';
            
            let previewHTML = '';
            
            if (currentState.sectionsVisible.toc) {
                let tocHTML = '<div class="preview-toc"><div class="preview-toc-title">Î™©Ï∞®</div><div style="margin-top: 10px;">';
                currentState.tocItems.forEach(item => {
                    const className = item.level === 2 ? 'preview-toc-item sub' : 'preview-toc-item';
                    tocHTML += `<div class="${className}">${item.text}</div>`;
                });
                tocHTML += '</div></div>';
                previewHTML += tocHTML;
            }
            
            if (currentState.sectionsVisible.profile) {
                const languageLines = info.languages.split('\n').map(line => line.trim()).filter(line => line);
                const languageHTML = languageLines.map(line => `${line}<br>`).join('');

                const profileHTML = `
                    <div class="preview-info-table">
                        <table style="width: 100%; border-collapse: collapse;">
                            <tr><td colspan="2" class="preview-header"><span style="color: #bd0000;">${info.number} ‚∏∫ ${info.nameEng}</span><br><span style="color: #bd0000; font-size: 1.7em;"><b>${info.nameKor}</b></span></td></tr>
                            <tr><td colspan="2" style="background: #000; color: #fff; text-align: center; padding: 8px;">"${info.quote}"</td></tr>
                            <tr><td class="preview-label">Î≥∏Î™Ö</td><td class="preview-value">${info.fullName}</td></tr>
                            <tr><td class="preview-label">ÏÑ±Î≥Ñ</td><td class="preview-value">${info.gender}</td></tr>
                            <tr><td class="preview-label">Ïã†Ïû•</td><td class="preview-value">${info.height}</td></tr>
                            <tr><td class="preview-label">ÏÜåÏÜç</td><td class="preview-value">${info.affiliation}</td></tr>
                            <tr><td class="preview-label">ÏßÅÏúÑ</td><td class="preview-value">${info.position}</td></tr>
                            <tr><td class="preview-label">ÏÉÅÏßïÏÉâ</td><td class="preview-value"><span class="color-preview" style="background-color: ${info.colorCode};"><b>${info.colorName}</b> (${info.colorCode})</span></td></tr>
                            <tr><td class="preview-label">Ïñ∏Ïñ¥Î≥Ñ ÌëúÍ∏∞</td><td class="preview-value">${languageHTML}</td></tr>
                        </table>
                    </div>
                `;
                previewHTML += profileHTML;
            }

            if (currentState.sectionsVisible['identity-ego-list']) {
                const listData = currentState.identityEgoList;

                const prisonerName = listData.prisonerName || '(‚òÖÏù¥Î¶Ñ)';
                const colorCode = listData.colorCode || '#bd0000';
                
                previewHTML += `
<table style="margin: 0 auto; margin-top: 5px; margin-bottom: 6px; border-collapse: collapse; width: 75%; border: 2px solid ${colorCode};" border="1">
<tbody>
<tr>
<td style="background-color: #000000; width: 100%; text-align: center; border: 1px solid #ffffff;">
<img src="https://imgur.com/NQx1b4k.png" width="25%" height="auto" />
<div style="margin: 0 auto; vertical-align: middle;"><span style="color: #f1bf02; font-size: 16px;"><b>${prisonerName}Ïùò Ïù∏Í≤© & E.G.O Î™©Î°ù</b></span></div>
</td>
</tr>
<tr>
<td style="background-color: ${colorCode}; width: 100%; text-align: center; border: 1px solid #ffffff;">
<div id="limbusclick111" style="display: inline-block; cursor: pointer;" onclick="var rows = document.querySelectorAll('.limbusopen111'); rows.forEach(function(r) { r.style.display = r.style.display === 'none' ? '' : 'none'; });"><span style="color: #ffffff; font-size: 17px;"><b>[ Ïù∏Í≤© ]</b></span></div><div id="limbusclick222" style="display: inline-block; margin-left: 10%; cursor: pointer;" onclick="var rows = document.querySelectorAll('.limbusopen222'); rows.forEach(function(r) { r.style.display = r.style.display === 'none' ? '' : 'none'; });"><span style="color: #ffffff; font-size: 17px;"><b>[ E.G.O ]</b></span></div>
</td>
</tr>
`;

            if (listData.identities.star3.length > 0) {
                previewHTML += `
<tr class="limbusopen111" style="display: none;">
<td style="background-image: linear-gradient(100deg, #ffe039 2%, transparent 2%, transparent 98%, #ffe039 98%); background-color: #1f2227; border: 1px solid #ffffff;">
<img src="https://imgur.com/bCY59j0.png" width="10%" height="auto" style="margin-left: 5px;" /> <span style="margin-left: 0.2%; color: #ffc412; text-shadow: -1px 0 #cc4d04, 0 1px #cc4d04, 1px 0 #cc4d04, 0 -1px #cc4d04; font-size: 14px;"><b>3ÏÑ±</b></span>
</td>
</tr>
<tr class="limbusopen111" style="display: none;">
<td style="background-color: #000000; border: 1px solid #ffffff; padding: 3px;">
<table style="border-style: hidden; border-collapse: separate; border-spacing: 3px 0; width: 100%; margin: 0;" border="0">
<colgroup>`;
                for (let i = 0; i < 7; i++) {
                    previewHTML += '<col width="14%">';
                }
                previewHTML += `</colgroup>
<tbody>
<tr>`;
                listData.identities.star3.forEach(item => {
                    previewHTML += `
<td style="padding: 3px !important; box-shadow: 0 0 0 1.5px #3a2716 inset; background-color: #ffe039;">
<img style="border: 1.5px solid #3a2716; width: 100%;" src="${item.imageUrl}" />
</td>`;
                });
                previewHTML += `
</tr>
</tbody>
</table>
</td>
</tr>
`;
            }

            if (listData.identities.star2.length > 0) {
                previewHTML += `
<tr class="limbusopen111" style="display: none;">
<td style="background-image: linear-gradient(100deg, #e4a600 2%, transparent 2%, transparent 98%, #e4a600 98%); background-color: #1f2227; border: 1px solid #ffffff;">
<img src="https://imgur.com/eMGR0sP.png" width="7%" height="auto" style="margin-left: 5px;" /> <span style="margin-left: 0.2%; color: #e4a600; text-shadow: -1px 0 #97460d, 0 1px #97460d, 1px 0 #97460d, 0 -1px #97460d; font-size: 14px;"><b>2ÏÑ±</b></span>
</td>
</tr>
<tr class="limbusopen111" style="display: none;">
<td style="background-color: #000000; border: 1px solid #ffffff; padding: 3px;">
<table style="border-style: hidden; border-collapse: separate; border-spacing: 3px 0; width: 100%; margin: 0;" border="0">
<colgroup>`;
                for (let i = 0; i < 7; i++) {
                    previewHTML += '<col width="14%">';
                }
                previewHTML += `</colgroup>
<tbody>
<tr>`;
                listData.identities.star2.forEach(item => {
                    previewHTML += `
<td style="padding: 3px !important; box-shadow: 0 0 0 1.5px #3a2716 inset; background-color: #ffe039;">
<img style="border: 1.5px solid #3a2716; width: 100%;" src="${item.imageUrl}" />
</td>`;
                });
                previewHTML += `
</tr>
</tbody>
</table>
</td>
</tr>
`;
            }

            const egoGrades = [
                { name: 'ZAYIN', image: 'https://imgur.com/3oJzNKT.png' },
                { name: 'TETH', image: 'https://imgur.com/hz5jgY5.png' },
                { name: 'HE', image: 'https://imgur.com/6PAd5mK.png' },
                { name: 'WAW', image: 'https://imgur.com/iRKJNBI.png' },
                { name: 'ALEPH', image: 'https://imgur.com/eCJVjR3.png' }
            ];

            egoGrades.forEach(grade => {
                if (listData.egos[grade.name].length > 0) {
                    previewHTML += `
<tr class="limbusopen222" style="display: none;">
<td style="background-image: linear-gradient(100deg, #ad7640 2%, transparent 2%, transparent 98%, #ad7640 98%); background-color: #1f2227; border: 1px solid #ffffff;">
<img src="${grade.image}" width="10%" height="auto" style="margin-left: 5px;" />
</td>
</tr>
<tr class="limbusopen222" style="display: none;">
<td style="background-color: #000000; border: 1px solid #ffffff; padding: 3px;">
<table style="border-style: hidden; border-collapse: separate; border-spacing: 3px 0; width: 100%; margin: 0;" border="0">
<colgroup>`;
                    for (let i = 0; i < 5; i++) {
                        previewHTML += '<col width="20%">';
                    }
                    previewHTML += `</colgroup>
<tbody>
<tr>`;
                    listData.egos[grade.name].forEach(item => {
                        previewHTML += `
<td style="padding: 3px !important; box-shadow: 0 0 0 1.5px #3a2716 inset; background-color: #996633;">
<img style="background-color: #3a2716; width: 100%;" src="${item.imageUrl}" />
<span style="background-color: #3a2716; display: block; text-align: center; color: #ecbf40; font-size: 11px;">${item.name}</span>
</td>`;
                    });
                    previewHTML += `
</tr>
</tbody>
</table>
</td>
</tr>
`;
                }
            });

            previewHTML += `
<tr>
<td style="background-color: #000000; width: 100%; text-align: center; border: 1px solid #ffffff;">
<span style="display: inline-block; margin-top: 5px; padding-left: 5px; padding-right: 5px; border-radius: 5px; background-color: #3c4150; color: #ffffff;">ÌïòÏñÄ ÌÖåÎëêÎ¶¨</span><span style="color: #ffffff;">&nbsp;&nbsp;: ÌïòÏù¥ÎùºÏù¥Ìä∏ Ïù∏Í≤©/Î©îÏù∏ E.G.O</span><br>
<span style="display: inline-block; margin-top: 5px; padding-left: 5px; padding-right: 5px; border-radius: 5px; background-color: #3c4f3b; color: #90d062;">Ï¥àÎ°ù ÌÖåÎëêÎ¶¨</span><span style="color: #ffffff;">&nbsp;&nbsp;: Î∞úÌë∏Î•¥Í∏∞Ïä§Ïùò Î∞§ Ïù∏Í≤©/E.G.O</span><br>
<span style="display: inline-block; margin-top: 5px; padding-left: 5px; padding-right: 5px; border-radius: 5px; background-color: #044377; color: #77bbfb;">ÌååÎûÄ ÌÖåÎëêÎ¶¨</span><span style="color: #ffffff;">&nbsp;&nbsp;: ÏΩúÎùºÎ≥¥Î†àÏù¥ÏÖò ÌïúÏ†ï E.G.O</span><br>
<span style="color: #ffffff;">Îç± Ï∂îÏ≤ú Ï°∞Ìï©ÏùÄ <span style="color: #006dd7;">ÌÇ§ÏõåÎìú</span> Î¨∏ÏÑú Ï∞∏Í≥†.</span>
</td>
</tr>
</tbody>
</table>
`;
            }

            document.getElementById('preview').innerHTML = `<div>${previewHTML}</div>`;
        }

        function loadIdentityInfo() {
            document.getElementById('identityName').value = currentState.identityInfo.identityName || '';
            document.getElementById('identityLogoUrl').value = currentState.identityInfo.identityLogoUrl || '';
            document.getElementById('representColor').value = currentState.identityInfo.representColor || '';
            document.getElementById('acquireDialogue').value = currentState.identityInfo.acquireDialogue || '';
            document.getElementById('identityIllust').value = currentState.identityInfo.illustUrl || '';
            document.getElementById('commissionSource').value = currentState.identityInfo.commissionSource || '';
            document.getElementById('hp').value = currentState.identityInfo.hp || '';
            document.getElementById('speed').value = currentState.identityInfo.speed || '';
            document.getElementById('defense').value = currentState.identityInfo.defense || '';
            document.getElementById('slashRes').value = currentState.identityInfo.slashRes || '';
            document.getElementById('pierceRes').value = currentState.identityInfo.pierceRes || '';
            document.getElementById('bluntRes').value = currentState.identityInfo.bluntRes || '';
            document.getElementById('prisonerName').value = currentState.identityInfo.prisonerName || '';
            document.getElementById('season').value = currentState.identityInfo.season || '';
            document.getElementById('grade').value = currentState.identityInfo.grade || '';
            document.getElementById('releaseDate').value = currentState.identityInfo.releaseDate || '';
            document.getElementById('greeting').value = currentState.identityInfo.greeting || '';
            document.getElementById('obtainMethod').value = currentState.identityInfo.obtainMethod || '';
            document.getElementById('keywords').value = currentState.identityInfo.keywords || '';
            document.getElementById('sdImageUrl').value = currentState.identityInfo.sdImageUrl || '';
            document.getElementById('storyTitle').value = currentState.identityInfo.storyTitle || '';
            document.getElementById('storyContent').value = currentState.identityInfo.storyContent || '';
            renderDialogueList();
        }

        function updateMenu2Preview() {
            const data = {
                identityName: document.getElementById('identityName').value || '(‚òÖÏù∏Í≤© Ïù¥Î¶Ñ)',
                identityLogoUrl: document.getElementById('identityLogoUrl').value || '',
                representColor: document.getElementById('representColor').value || '',
                acquireDialogue: document.getElementById('acquireDialogue').value || '(‚òÖÌöçÎìù ÎåÄÏÇ¨)',
                illustUrl: document.getElementById('identityIllust').value || '',
                commissionSource: document.getElementById('commissionSource').value || '(‚òÖÏª§ÎØ∏ÏÖò Ï∂úÏ≤ò)',
                hp: document.getElementById('hp').value || '000',
                speed: document.getElementById('speed').value || '00-00',
                defense: document.getElementById('defense').value || '00(+0)',
                slashRes: document.getElementById('slashRes').value || 'Î≥¥ÌÜµ',
                pierceRes: document.getElementById('pierceRes').value || 'Î≥¥ÌÜµ',
                bluntRes: document.getElementById('bluntRes').value || 'Î≥¥ÌÜµ',
                prisonerName: document.getElementById('prisonerName').value || '(‚òÖÏù¥Î¶Ñ)',
                season: document.getElementById('season').value || '(‚òÖÏãúÏ¶å)',
                grade: document.getElementById('grade').value || '(‚òÖÎì±Í∏â)',
                releaseDate: document.getElementById('releaseDate').value || '(‚òÖÎÇ†Ïßú)',
                greeting: document.getElementById('greeting').value || '(‚òÖÎåÄÏÇ¨)',
                obtainMethod: document.getElementById('obtainMethod').value || '(‚òÖÌöçÎìù Î∞©Î≤ï)',
                keywords: document.getElementById('keywords').value || '(‚òÖÌÇ§ÏõåÎìú)',
                sdImageUrl: document.getElementById('sdImageUrl').value || '',
                storyTitle: document.getElementById('storyTitle').value || '',
                storyContent: document.getElementById('storyContent').value || '',
                dialogues: currentState.identityInfo.dialogues
            };

            currentState.identityInfo = data;

            let previewHTML = '<div style="zoom: 0.7; display: inline-block;">';
            
            previewHTML += `
<table style="margin: 5px auto 6px auto; border-collapse: collapse; width: 100%; max-width: 750px; border: 2px solid #000000;" border="1">
<tbody>
<tr>
<td style="background-color: #000000; width: 100%; text-align: center;">
<div style="display: inline-block; vertical-align: middle; margin-right: 1%;">${data.identityLogoUrl ? `<img src="${data.identityLogoUrl}" width="30" height="auto" />` : ''}</div><div style="display: inline-block; vertical-align: middle; width: 50%;"><span style="color: #ffcc99; text-shadow:1px 2px 1px #000000, 2px 1px 2px #000000; display:block; text-decoation:none; background-image: linear-gradient(to left, #000000, ${data.representColor || '#000000'} 10%, ${data.representColor || '#000000'} 90%, #000000); font-size: 18px;"><b>${data.identityName}</b></span></div>
</td>
</tr>
<tr>
<td style="background-color: #000000; width: 100%; text-align: center;">
<div style="margin-top: 5px; margin-bottom: 5px;"><span style="color: ${data.representColor || '#ffcc99'}; font-size: 15px;">"${data.acquireDialogue}"</span></div>
</td>
</tr>
<tr>
<td style="background-color: #000000;">
<div style="margin-top: 5px;">
<table style="box-shadow: 0 0 0 1.5px #996633; border-style: hidden; border-radius: 3px; margin: 0 auto 6px auto; max-width: 100%;" border="0">
<tbody>
<tr>
<td style="padding: 6px !important; box-shadow: 0 0 0 3px #2a1814 inset; background-color: #000000; width: 100%; text-align: center;">
${data.illustUrl ? `<img style="border: 1.5px solid #996633; max-width: 100%; height: auto;" src="${data.illustUrl}" />` : '<div style="padding: 40px; color: #666;">ÏùºÎü¨Ïä§Ìä∏ Ïù¥ÎØ∏ÏßÄ ÏóÜÏùå</div>'}
</td>
</tr>
<tr>
<td style="color: #ffcc99; background-color: #2a1814; width: 100%; text-align: center;">
${data.commissionSource}
<div style="height: 3px;"></div>
</td>
</tr>
</tbody>
</table>
</div>
</td>
</tr>
<tr>
<td style="background-color: #000000; padding: 5px;">

<table style="display: inline-block; vertical-align: top; table-layout: fixed; border-collapse: collapse; width: 49%; border: 2px solid #996633; margin-top: -3px;" border="1" data-ke-align="alignLeft">
<tbody>
<tr>
<td style="background-image: linear-gradient(120deg, #996633 2%, transparent 2%, transparent 3%, #996633 3%, #996633 4%, transparent 4%, transparent 5%, #996633 5%, #996633 6%, transparent 6%, transparent 94%, #996633 94%, #996633 95%, transparent 95%, transparent 96%, #996633 96%, #996633 97%, transparent 97%, transparent 98%, #996633 98%); background-color: #170c0a; text-align: center; border: 1px solid #996633; padding: 8px;">
<span style="color: #ffcc66; font-size: 15px;"><b>Ïä§ÌÖåÏù¥ÌÑ∞Ïä§</b></span>
</td>
</tr>
<tr>
<td style="background-color: #3a2716; text-align: center; border: 0px solid #ffffff; padding: 5px;">
<div style="margin-top: 10px">
<span style="color: #ffcc66; font-size: 15px;">ÏµúÎåÄ Î†àÎ≤® ¬∑ ÎèôÍ∏∞Ìôî Í∏∞Ï§Ä</span>
</div>
</td>
</tr>
<tr>
<td style="background-color: #3a2716; border: 0px solid #ffffff; padding: 8px 8px 14px 8px;">
<table style="table-layout: fixed; border-collapse: collapse; width: 100%; border: 0px solid #ffffff; margin-top: -10px; margin-bottom: 10px;" border="0" data-ke-align="alignLeft">
<colgroup>
    <col style="width: 33.33%;">
    <col style="width: 33.33%;">
    <col style="width: 33.33%;">
</colgroup>
<tbody>
<tr>
<td style="border: 0px solid #ffffff; padding: 5px; text-align: center;">
  <img src="https://imgur.com/QiQNqoj.png" style="width: 30%; display: inline; vertical-align: middle;"><span style="color: #ffcc99; font-size: 15px; display: inline; vertical-align: middle;">&nbsp;${data.hp}</span>
</td>
<td style="border: 0px solid #ffffff; padding: 5px; text-align: center;">
  <img src="https://imgur.com/vDlteFd.png" style="width: 30%; display: inline; vertical-align: middle;"><span style="color: #ffcc99; font-size: 15px; display: inline; vertical-align: middle;">&nbsp;${data.speed}</span>
</td>
<td style="border: 0px solid #ffffff; padding: 5px; text-align: center;">
  <img src="https://imgur.com/EDeVwvr.png" style="width: 30%; display: inline; vertical-align: middle;"><span style="color: #ffcc99; font-size: 15px; display: inline; vertical-align: middle;">&nbsp;${data.defense}</span>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>

<table style="display: inline-block; vertical-align: top; table-layout: fixed; border-collapse: collapse; margin-left: 1.4%; width: 49%; border: 2px solid #996633; margin-top: -3px;" border="1" data-ke-align="alignLeft">
<tbody>
<tr>
<td style="background-image: linear-gradient(120deg, #996633 2%, transparent 2%, transparent 3%, #996633 3%, #996633 4%, transparent 4%, transparent 5%, #996633 5%, #996633 6%, transparent 6%, transparent 94%, #996633 94%, #996633 95%, transparent 95%, transparent 96%, #996633 96%, #996633 97%, transparent 97%, transparent 98%, #996633 98%); background-color: #170c0a; text-align: center; border: 1px solid #996633; padding: 8px;">
<span style="color: #ffcc66; font-size: 15px;"><b>ÎÇ¥ÏÑ± Ï†ïÎ≥¥</b></span>
</td>
</tr>
<tr>
<td style="background-color: #3a2716; border: 0px solid #ffffff; padding: 8px;">
<table style="table-layout: fixed; border-collapse: collapse; width: 100%; border: 0px; margin: 5 auto;" border="0" data-ke-align="alignLeft">
<colgroup>
    <col style="width: 33.33%;">
    <col style="width: 33.33%;">
    <col style="width: 33.33%;">
</colgroup>
<tbody>
<tr>
<td style="border: 0px; padding: 8px; width: 33.33%;" align="center">
<span style="color: #9f5621; display: block;">Ï∞∏Í≤©</span>
<img src="https://imgur.com/RyM6DEK.png" style="display: block; width: 30%; margin: 0 auto;">
<span style="color: #ffcc99; font-size: 15px; display: block;">${data.slashRes}</span>
</td>
<td style="border: 0px; padding: 8px; width: 33.33%;" align="center">
<span style="color: #9f5621; display: block;">Í¥ÄÌÜµ</span>
<img src="https://imgur.com/egXA0qD.png" style="display: block; width: 35%; margin: 0 auto;">
<span style="color: #ffcc99; font-size: 15px; display: block;">${data.pierceRes}</span>
</td>
<td style="border: 0px; padding: 8px; width: 33.33%;" align="center">
<span style="color: #9f5621; display: block;">ÌÉÄÍ≤©</span>
<img src="https://imgur.com/Vr57eHh.png" style="display: block; width: 32%; margin: 0 auto;">
<span style="color: #ffcc99; font-size: 15px; display: block;">${data.bluntRes}</span>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table> 
</td>
</tr>
<tr>
<td style="background-color: #000000; padding: 5px;">
<table style="width:100%; border-collapse: collapse; border: 2px solid #996633; margin-top: 2px; margin-bottom: 6px;" border="1" cellspacing="0" cellpadding="0" data-ke-align="alignLeft">
    <colgroup> 
        <col style="width: 20%;"> 
        <col style="width: 30%;"> 
        <col style="width: 20%;"> 
        <col style="width: 30%;"> 
    </colgroup>
<tbody>
<tr>
<td style="margin: 0px; padding: 8px; border-spacing: 0px; background-image: linear-gradient(120deg, #996633 2%, transparent 2%, transparent 3%, #996633 3%, #996633 4%, transparent 4%, transparent 5%, #996633 5%, #996633 6%, transparent 6%, transparent 94%, #996633 94%, #996633 95%, transparent 95%, transparent 96%, #996633 96%, #996633 97%, transparent 97%, transparent 98%, #996633 98%); background-color: #170c0a; text-align: center; border: 1px solid #996633;" colspan="4">
<span style="color: #ffcc66; font-size: 15px;"><b>Í∏∞Î≥∏ Ï†ïÎ≥¥</b></span>
</td>
</tr>
<tr>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">ÏàòÍ∞êÏûê</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">${data.prisonerName}</span>
</td>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">ÏãúÏ¶å</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">${data.season}</span>
</td>
</tr>
<tr>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">Ïù∏Í≤© Îì±Í∏â</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">${data.grade}</span>
</td>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">Ï∂úÏãú ÏãúÍ∏∞</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">${data.releaseDate}</span>
</td>
</tr>
<tr>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">Ìã∞Ïºì Ïù∏ÏÇ¨Îßê</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;" colspan="3">
<span style="color: #ffcc99;">${data.greeting}</span>
</td>
</tr>
<tr>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">ÌöçÎìù Î∞©Î≤ï</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;" colspan="3">
<span style="color: #ffcc99;">${data.obtainMethod}</span>
</td>
</tr>
<tr>
<td style="background-color: #000000; text-align: center; padding: 8px;">
<span style="color: #ffcc99;">ÌäπÏÑ± ÌÇ§ÏõåÎìú</span>
</td>
<td style="background-color: #3a2716; text-align: center; padding: 8px;" colspan="3">
<span style="color: #ffcc99;">${data.keywords}</span>
</td>
</tr>
</tbody>
</table>
</td>
</tr>
</tbody>
</table>
`;
            
            if (data.storyTitle && data.storyContent) {
                previewHTML += `
<table style="margin: 5px auto 6px auto; border-collapse: collapse; width: 100%; max-width: 750px; border: 2px solid #000000;" border="1">
<tbody>
<tr>
<td style="background-color: #000000; width: 100%; text-align: center;">
<div style="border: 1.5px solid #996633; border-radius: 3px; background-color: #170C0A;">
<span style="color: #f0cc66;"><b>${data.storyTitle}</b></span>
</div>
</td>
</tr>
<tr>
<td style="width: 100%; text-align: center; border: 1px solid #000000; background-color: #000000; color: #ffcc99; cursor: pointer;" onclick="var rows = document.querySelectorAll('.limbusopen_story'); rows.forEach(function(r) { r.style.display = r.style.display === 'none' ? '' : 'none'; });">
<b>[ ÌéºÏπòÍ∏∞ ¬∑ Ï†ëÍ∏∞ ]</b>
</td>
</tr>
<tr class="limbusopen_story" style="display: none;">
<td style="width: 100%; color: #ffffff; background-color: #000000;">
<br>
${data.storyContent.replace(/\n/g, '<br>')}
</td>
</tr>
</tbody>
</table>
`;
            }
            
            if (data.dialogues && data.dialogues.length > 0) {
                const filledDialogues = data.dialogues.filter(d => d.label && d.content);
                
                if (filledDialogues.length > 0) {
                    previewHTML += `
<table style="margin: 5px auto 6px auto; border-collapse: collapse; width: 100%; max-width: 750px; border: 2px solid #000000;" border="1">
<tbody>
<tr>
<td style="background-color: #000000; width: 100%; text-align: center;">
<div style="border: 1.5px solid #996633; border-radius: 3px; background-color: #170C0A;">
<span style="color: #f0cc66;"><b>ÎåÄÏÇ¨</b></span>
</div>
</td>
</tr>
<tr>
<td style="width: 100%; text-align: center; border: 1px solid #000000; background-color: #000000; color: #ffcc99; cursor: pointer;" onclick="var rows = document.querySelectorAll('.limbusopen_dialogue'); rows.forEach(function(r) { r.style.display = r.style.display === 'none' ? '' : 'none'; });">
<b>[ ÌéºÏπòÍ∏∞ ¬∑ Ï†ëÍ∏∞ ]</b>
</td>
</tr>
`;
                    
                    filledDialogues.forEach((dialogue, index) => {
                        previewHTML += `
<tr class="limbusopen_dialogue" style="display: none;">
<td style="width: 100%; border: 1px solid #dddddd; background-color: #000000;">
<ul style="list-style-type: disc; color: ${data.representColor || '#c55554'};">
<li><span style="color: #ffcc99;">${dialogue.label}</span><br><span style="color: ${data.representColor || '#c55554'};">"${dialogue.content}"</span></li>
</ul>
</td>
</tr>
`;
                    });
                    
                    previewHTML += `
</tbody>
</table>
`;
                }
            }
            
            if (data.sdImageUrl) {
                previewHTML += `
<div align="center" style="margin-top: 5px;">
<table style="border-collapse: collapse; width: 50%; max-width: 375px; margin: 0 auto; border: 2px solid ${data.representColor || '#996633'};" border="1">
<tbody>
<tr>
<td style="padding: 0 !important; margin: 0 !important; width: 100%; text-align: center; border: none;"><img src="${data.sdImageUrl}" style="width: 100%; max-width: 100%; height: auto;" /></td>
</tr>
<tr>
<td style="width: 100%; text-align: center; border: none; border: 1px solid #dddddd;" bgcolor="${data.representColor || '#996633'}"><span style="color: #ffffff;"><b>${data.prisonerName}</b></span></td>
</tr>
</tbody>
</table>
</div>
`;
            }
            
            previewHTML += '</div>';
            document.getElementById('preview').innerHTML = previewHTML;
        }


        function loadEgoInfo() {
            document.getElementById('logoUrl').value = currentState.egoInfo.logoUrl || '';
            document.getElementById('egoTitle').value = currentState.egoInfo.title || '';
            document.getElementById('egoQuote').value = currentState.egoInfo.quote || '';
            document.getElementById('illustUrl').value = currentState.egoInfo.illustUrl || '';
            document.getElementById('abnormality').value = currentState.egoInfo.abnormality || '';
            document.getElementById('egoSeason').value = currentState.egoInfo.season || '';
            document.getElementById('egoName').value = currentState.egoInfo.egoName || '';
            document.getElementById('egoGrade').value = currentState.egoInfo.egoGrade || '';
            document.getElementById('egoPrisoner').value = currentState.egoInfo.prisoner || '';
            document.getElementById('egoReleaseDate').value = currentState.egoInfo.releaseDate || '';
            document.getElementById('egoGreeting').value = currentState.egoInfo.greeting || '';
            document.getElementById('egoObtain').value = currentState.egoInfo.obtainMethod || '';
            document.getElementById('egoKeywords').value = currentState.egoInfo.keywords || '';
            document.getElementById('egoBgColor').value = currentState.egoInfo.bgColor || '#73468a';
        }

        function updateMenu3Preview() {
            const data = {
                logoUrl: document.getElementById('logoUrl').value || '',
                title: document.getElementById('egoTitle').value || 'Ïù∏Í≤© Î™ÖÏπ≠',
                quote: document.getElementById('egoQuote').value || 'ÎåÄÏÇ¨',
                illustUrl: document.getElementById('illustUrl').value || '',
                abnormality: document.getElementById('abnormality').value || '(‚òÖÌôòÏÉÅÏ≤¥)',
                season: document.getElementById('egoSeason').value || '(‚òÖÏãúÏ¶å)',
                egoName: document.getElementById('egoName').value || '(‚òÖE.G.O)',
                egoGrade: document.getElementById('egoGrade').value || '(‚òÖÎì±Í∏â)',
                prisoner: document.getElementById('egoPrisoner').value || '(‚òÖÏàòÍ∞êÏûê)',
                releaseDate: document.getElementById('egoReleaseDate').value || '(‚òÖÎÇ†Ïßú)',
                greeting: document.getElementById('egoGreeting').value || '(‚òÖÌã∞Ïºì Ïù∏ÏÇ¨Îßê)',
                obtainMethod: document.getElementById('egoObtain').value || '(‚òÖÌöçÎìù Î∞©Î≤ï)',
                keywords: document.getElementById('egoKeywords').value || '(‚òÖÌÇ§ÏõåÎìú)',
                bgColor: document.getElementById('egoBgColor').value || '#73468a'
            };

            const gradeImages = {
                'ZAYIN': 'https://i.imgur.com/3oJzNKT.png',
                'TETH': 'https://i.imgur.com/hz5jgY5.png',
                'HE': 'https://i.imgur.com/6PAd5mK.png',
                'WAW': 'https://i.imgur.com/iRKJNBI.png',
                'ALEPH': 'https://i.imgur.com/eCJVjR3.png'
            };

            currentState.egoInfo = data;

            let previewHTML = '<div>';
            
            previewHTML += `
                <div style="background: #000; padding: 10px;">
                    <div style="text-align: center; margin-bottom: 10px; padding-top: 10px;">`;
            
            if (data.logoUrl) {
                previewHTML += `<div style="display: inline-block; vertical-align: middle; margin-right: 1%;"><img src="${data.logoUrl}" width="30" height="auto"></div>`;
            }
            
            previewHTML += `<div style="display: inline-block; vertical-align: middle; width: 50%;"><span style="color: #000000; text-shadow: -1px -1px 0 #ffcc99, 1px -1px 0 #ffcc99, -1px 1px 0 #ffcc99, 1px 1px 0 #ffcc99; display:block; text-decoration:none; background-image: linear-gradient(to left, #000000, ${data.bgColor} 10%, ${data.bgColor} 90%, #000000); font-size: 18px;"><b>${data.title}</b></span></div>
                    </div>
                    <div style="text-align: center; margin-bottom: 15px; font-style: italic; color: #ffcc99;">"${data.quote}"</div>`;
            
            if (data.illustUrl) {
                previewHTML += `<div style="text-align: center; margin-bottom: 20px;"><img src="${data.illustUrl}" style="max-width: 100%;"></div>`;
            }
            
            previewHTML += `
                    <table class="preview-table">
                        <colgroup>
                            <col style="width: 20%;"/>
                            <col style="width: 30%;"/>
                            <col style="width: 20%;"/>
                            <col style="width: 30%;"/>
                        </colgroup>
                        <tbody>
                            <tr>
                                <td class="header-cell" colspan="4">
                                    <span style="color: #ffcc66; font-size: 15px;"><b>E.G.O Ï†ïÎ≥¥</b></span>
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">ÌôòÏÉÅÏ≤¥</span></td>
                                <td class="value-cell"><span style="color: #ffcc99;">${data.abnormality}</span></td>
                                <td class="label-cell"><span style="color: #ffcc99;">ÏãúÏ¶å</span></td>
                                <td class="value-cell"><span style="color: #ffcc99;">${data.season}</span></td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">E.G.O Î™ÖÏπ≠</span></td>
                                <td class="value-cell"><span style="color: #ffcc99;">${data.egoName}</span></td>
                                <td class="label-cell"><span style="color: #ffcc99;">E.G.O Îì±Í∏â</span></td>
                                <td class="value-cell">
                                    ${gradeImages[data.egoGrade] ? `<img src="${gradeImages[data.egoGrade]}" style="height: 20px; vertical-align: middle;" />` : `<span style="color: #ffcc99;">${data.egoGrade}</span>`}
                                </td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">ÏàòÍ∞êÏûê</span></td>
                                <td class="value-cell"><span style="color: #ffcc99;">${data.prisoner}</span></td>
                                <td class="label-cell"><span style="color: #ffcc99;">Ï∂úÏãú ÏãúÍ∏∞</span></td>
                                <td class="value-cell"><span style="color: #ffcc99;">${data.releaseDate}</span></td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">Ìã∞Ïºì Ïù∏ÏÇ¨Îßê</span></td>
                                <td class="value-cell" colspan="3"><span style="color: #ffcc99;">${data.greeting}</span></td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">ÌöçÎìù Î∞©Î≤ï</span></td>
                                <td class="value-cell" colspan="3"><span style="color: #ffcc99;">${data.obtainMethod}</span></td>
                            </tr>
                            <tr>
                                <td class="label-cell"><span style="color: #ffcc99;">ÌäπÏÑ± ÌÇ§ÏõåÎìú</span></td>
                                <td class="value-cell" colspan="3"><span style="color: #ffcc99;">${data.keywords}</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            `;

            document.getElementById('preview').innerHTML = previewHTML;
        }

        function renderContentSections() {
            const container = document.getElementById('contentSections');
            container.innerHTML = '';
            
            currentState.tocItems.forEach((item, index) => {
                const sectionId = `content-${index}`;
                const content = currentState.contentSections[index] || '';
                
                const sectionDiv = document.createElement('div');
                sectionDiv.innerHTML = `
                    <div class="content-section-header" onclick="toggleContentSection('${sectionId}')">
                        <span>${item.text}</span>
                        <span class="arrow">‚ñº</span>
                    </div>
                    <div class="content-editor" id="${sectionId}">
                        <textarea placeholder="Î≥∏Î¨∏ ÎÇ¥Ïö©ÏùÑ ÏûÖÎ†•ÌïòÏÑ∏Ïöî..." oninput="updateContentSection(${index}, this.value)">${content}</textarea>
                    </div>
                `;
                container.appendChild(sectionDiv);
            });
        }

        function toggleContentSection(sectionId) {
            const section = document.getElementById(sectionId);
            const header = section.previousElementSibling;
            section.style.display = section.style.display === 'none' ? 'block' : 'none';
            const arrow = header.querySelector('.arrow');
            arrow.style.transform = section.style.display === 'none' ? 'rotate(-90deg)' : 'rotate(0deg)';
        }

        function updateContentSection(index, content) {
            currentState.contentSections[index] = content;
            updateMenu4Preview();
        }

        function updateMenu4Preview() {
            let previewHTML = '<div class="preview-content">';
            
            currentState.tocItems.forEach((item, index) => {
                const content = currentState.contentSections[index] || '';
                const number = item.text.match(/^[\d.]+/)?.[0] || '';
                const title = item.text.replace(/^[\d.]+\.?\s*/, '');
                
                if (item.level === 1) {
                    previewHTML += `
                        <h3 data-ke-size="size23">
                            <b>‚à® <span style="color: #006dd7;">${number}</span> ${title}</b>
                        </h3>
                        <hr style="margin-top: 0px;" contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style6">
                    `;
                } else {
                    previewHTML += `
                        <h3 data-ke-size="size23" style="font-size: 1.1em; margin-left: 20px;">
                            <b>‚à® <span style="color: #006dd7;">${number}</span> ${title}</b>
                        </h3>
                        <hr style="margin-top: 0px;" contenteditable="false" data-ke-type="horizontalRule" data-ke-style="style6">
                    `;
                }
                
                if (content) {
                    const paragraphs = content.split('\n').filter(p => p.trim());
                    paragraphs.forEach(paragraph => {
                        previewHTML += `<p data-ke-size="size16">${paragraph}</p>`;
                    });
                }
                
                previewHTML += '<p data-ke-size="size16">&nbsp;</p>';
            });
            
            previewHTML += '</div>';
            document.getElementById('preview').innerHTML = previewHTML;
        }

        function downloadHTML() {
            const previewContent = document.getElementById('preview').innerHTML;
            
            const fullHTML = `<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏÉùÏÑ±Îêú HTML</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .preview-toc {
            border: 1px solid #ccc;
            border-radius: 4px;
            padding: 12px 20px 18px;
            margin-bottom: 20px;
            background: white;
        }
        .preview-toc-title {
            font-size: 1.25em;
            margin-bottom: 10px;
        }
        .preview-toc-item {
            color: #006dd7;
            margin: 5px 0;
        }
        .preview-toc-item.sub {
            padding-left: 22px;
        }
        .preview-info-table {
            width: 325px;
            border: 2px solid #bd0000;
            border-collapse: collapse;
            background: white;
            margin-bottom: 20px;
        }
        .preview-info-table td {
            border: 1px solid #000;
            padding: 8px;
        }
        .preview-header {
            background: #000;
            text-align: center;
            padding: 10px;
        }
        .preview-label {
            background: #000;
            color: #e1bf02;
            font-weight: bold;
            text-align: center;
            width: 30%;
        }
        .preview-value {
            background: white;
            text-align: left;
            padding-left: 12px;
        }
        .color-preview {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 5px;
            color: white;
            font-weight: bold;
        }
        .preview-content h3 {
            color: #333;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
        }
        .preview-content hr {
            margin: 0 0 15px 0;
            border: none;
            border-top: 2px solid #ddd;
        }
        .preview-content p {
            line-height: 1.6;
            margin: 10px 0;
            color: #333;
        }
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            border: 2px solid #996633;
            margin-top: 2px;
            margin-bottom: 6px;
        }
        .preview-table td {
            border: 1px solid #996633;
            padding: 8px;
            color: #ffcc99;
        }
        .preview-table .header-cell {
            background-image: linear-gradient(120deg, #996633 2%, transparent 2%, transparent 3%, #996633 3%, #996633 4%, transparent 4%, transparent 5%, #996633 5%, #996633 6%, transparent 6%, transparent 94%, #996633 94%, #996633 95%, transparent 95%, transparent 96%, #996633 96%, #996633 97%, transparent 97%, transparent 98%, #996633 98%);
            background-color: #170c0a;
            text-align: center;
            padding: 10px;
        }
        .preview-table .label-cell {
            background-color: #000000;
            text-align: center;
            width: 20%;
        }
        .preview-table .value-cell {
            background-color: #3a2716;
            text-align: center;
        }
    </style>
</head>
<body>
${previewContent}
</body>
</html>`;
            
            const blob = new Blob([fullHTML], { type: 'text/html' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'generated-content.html';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function saveJSON() {
            const jsonContent = JSON.stringify(currentState, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'project-state.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            alert('ÌòÑÏû¨ ÏûëÏóÖ ÏÉÅÌÉúÍ∞Ä JSON ÌååÏùºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§.');
        }

        function loadJSON(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const loadedState = JSON.parse(e.target.result);
                    currentState = loadedState;
                    
                    if (!currentState.sectionsVisible) {
                        currentState.sectionsVisible = { toc: true, profile: true };
                    }
                    
                    switchMenu(currentState.activeMenu);
                    alert('JSON ÌååÏùºÏùÑ ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Î∂àÎü¨ÏôîÏäµÎãàÎã§!');
                } catch (error) {
                    alert('JSON ÌååÏùºÏùÑ ÏùΩÎäî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§: ' + error.message);
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        window.onload = function() {
            currentState.sectionsVisible = {
                toc: !document.getElementById('toc-content').classList.contains('collapsed'),
                profile: !document.getElementById('profile-content').classList.contains('collapsed'),
                'identity-ego-list': !document.getElementById('identity-ego-list-content').classList.contains('collapsed')
            };
            
            renderTocList();
            loadWikiProfile();
            loadIdentityInfo();
            updateMenu1Preview();
        };
    </script>
</body>
</html>
